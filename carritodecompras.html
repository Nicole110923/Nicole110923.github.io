<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Carrito de Compras</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    body { font-family: 'Roboto', sans-serif; max-width: 600px; margin: 20px auto; padding: 10px; }
    ul { list-style: none; padding: 0; }
    li { margin-bottom: 8px; }
    button { cursor: pointer; padding: 8px 12px; margin-top: 10px; }
    #formulario-pago { display: none; margin-top: 20px; border: 1px solid #ccc; padding: 15px; border-radius: 5px; }
    label { display: block; margin-bottom: 10px; }
    input { width: 100%; padding: 6px; box-sizing: border-box; }
  </style>
</head>
<body>

  <h1>Carrito de Compras</h1>
  <ul id="carrito-lista"></ul>
  <p id="total">Total: $0</p>
  <button id="finalizar-compra">Finalizar compra</button>

  <div id="formulario-pago">
    <h2>Detalles de Pago</h2>
    <form id="pago-form">
      <label>
        Nombre completo:<br />
        <input type="text" name="nombre" required />
      </label>
      <label>
        Dirección:<br />
        <input type="text" name="direccion" required />
      </label>
      <label>
        Teléfono:<br />
        <input type="tel" name="telefono" required />
      </label>
      <label>
        Número de tarjeta:<br />
        <input type="text" name="tarjeta" required maxlength="16" pattern="\d{16}" title="16 dígitos" />
      </label>
      <button type="submit">Comprar</button>
    </form>
  </div>

<script>
  const carrito = JSON.parse(localStorage.getItem('carrito')) || [];
  const lista = document.getElementById('carrito-lista');
  const totalTexto = document.getElementById('total');
  const btnFinalizar = document.getElementById('finalizar-compra');
  const formularioPago = document.getElementById('formulario-pago');
  const pagoForm = document.getElementById('pago-form');

  // Mostrar items en carrito
  function mostrarCarrito() {
    lista.innerHTML = '';
    if(carrito.length === 0) {
      lista.innerHTML = '<li>Tu carrito está vacío.</li>';
      totalTexto.textContent = 'Total: $0';
      btnFinalizar.disabled = true;
      return;
    }
    btnFinalizar.disabled = false;

    let total = 0;
    carrito.forEach(item => {
      const li = document.createElement('li');
      li.textContent = `${item.titulo} - $${item.precio} x ${item.cantidad}`;
      lista.appendChild(li);
      total += item.precio * item.cantidad;
    });
    totalTexto.textContent = `Total: $${total}`;
  }

  mostrarCarrito();

  btnFinalizar.addEventListener('click', () => {
    formularioPago.style.display = 'block';
    btnFinalizar.style.display = 'none';
  });

  pagoForm.addEventListener('submit', (e) => {
    e.preventDefault();
    // Datos del formulario
    const datosPago = {
      nombre: pagoForm.nombre.value,
      direccion: pagoForm.direccion.value,
      telefono: pagoForm.telefono.value,
      tarjeta: pagoForm.tarjeta.value,
      carrito: carrito,
      total: carrito.reduce((sum, i) => sum + i.precio * i.cantidad, 0),
      fecha: new Date().toLocaleString()
    };
    // Guardar datos en sessionStorage para mostrar en comprobante
    sessionStorage.setItem('datosPago', JSON.stringify(datosPago));

    // Vaciar carrito en localStorage
    localStorage.removeItem('carrito');

    // Redirigir a comprobante
    window.location.href = 'comprobante.html';
  });
</script>

</body>
</html>
