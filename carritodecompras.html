<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Carrito de Compras | N'C BOOKS</title>
  <link href="https://fonts.googleapis.com/css2?family=Lato&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="carritodecompras.css" />
</head>
<body>

  <img src="logo.png" alt="logo" class="l" />
  <h1>游 Carrito de Compras</h1>

  <div id="carrito-contenido"></div>
  <p class="total" id="total">Total: $0</p>

  <button onclick="mostrarFormulario()">Pagar</button>
  <button onclick="vaciarCarrito()">Vaciar carrito</button>
  <a href="categoria.html"><button>Volver al cat치logo</button></a>
  <a href="index.html"><button>Volver al inicio</button></a>

  <main>
    <form id="formulario-compra" style="display:none;">
      <h2>Finaliza tu compra en N'C BOOKS</h2>

      <label for="nombre">Nombre del Titular</label>
      <input type="text" id="nombre" name="nombre" placeholder="Nombre completo del titular" required />

      <label for="direccion">Direcci칩n</label>
      <input type="text" id="direccion" name="direccion" placeholder="Direcci칩n de facturaci칩n" required />

      <label for="tipo-tarjeta">Tipo de Tarjeta</label>
      <select id="tipo-tarjeta" name="tipo-tarjeta" required>
        <option value="">Selecciona una opci칩n</option>
        <option value="Visa">Visa</option>
        <option value="MasterCard">MasterCard</option>
        <option value="Amex">American Express</option>
        <option value="Otro">Otro</option>
      </select>

      <label for="numero">N칰mero de Tarjeta</label>
      <input
        type="text"
        id="numero"
        name="numero"
        placeholder="Ingresa tu n칰mero de tarjeta"
        maxlength="16"
        pattern="\d{13,16}"
        inputmode="numeric"
        required
      />

      <label for="expiracion">Fecha de Expiraci칩n</label>
      <input type="month" id="expiracion" name="expiracion" required />

      <label for="cvv">CVV</label>
      <input
        type="text"
        id="cvv"
        name="cvv"
        placeholder="CVV"
        maxlength="4"
        pattern="\d{3,4}"
        inputmode="numeric"
        required
      />

      <label>
        <input type="checkbox" id="terminos" required />
        Acepto los <a href="terminos.html" target="_blank">t칠rminos y condiciones</a>.
      </label>

      <button type="submit">Confirmar Compra</button>
    </form>
  </main>

  <script>
    let carrito = JSON.parse(localStorage.getItem('carrito')) || [];
    const contenedor = document.getElementById('carrito-contenido');
    const totalTexto = document.getElementById('total');
    const formulario = document.getElementById('formulario-compra');

    function renderCarrito() {
      contenedor.innerHTML = '';
      let total = 0;
      if (carrito.length === 0) {
        contenedor.innerHTML = '<p>Tu carrito est치 vac칤o.</p>';
      } else {
        carrito.forEach((item, index) => {
          const div = document.createElement('div');
          div.className = 'item';
          div.innerHTML = `
            <img src="${item.imagen || 'https://via.placeholder.com/100'}" alt="${item.nombre}">
            <div class="item-info">
              <strong>${item.nombre}</strong><br>
              $${item.precio} x ${item.cantidad}
            </div>
            <button onclick="eliminarItem(${index})">Eliminar</button>
          `;
          contenedor.appendChild(div);
          total += item.precio * item.cantidad;
        });
      }
      totalTexto.textContent = `Total: $${total.toFixed(2)}`;
    }

    function eliminarItem(index) {
      carrito.splice(index, 1);
      localStorage.setItem('carrito', JSON.stringify(carrito));
      renderCarrito();
    }

    function vaciarCarrito() {
      if (confirm('쯌aciar el carrito?')) {
        carrito = [];
        localStorage.setItem('carrito', JSON.stringify(carrito));
        renderCarrito();
        formulario.style.display = 'none';
      }
    }

    function mostrarFormulario() {
      if (carrito.length === 0) {
        alert('Tu carrito est치 vac칤o.');
        return;
      }
      formulario.style.display = 'block';
      window.scrollTo(0, document.body.scrollHeight);
    }

    document.getElementById('numero').addEventListener('input', e => {
      e.target.value = e.target.value.replace(/\D/g, '').slice(0, 16);
    });

    document.getElementById('cvv').addEventListener('input', e => {
      e.target.value = e.target.value.replace(/\D/g, '').slice(0, 4);
    });

    formulario.addEventListener('submit', e => {
      e.preventDefault();
      if (!formulario.checkValidity()) {
        alert('Por favor, completa todos los campos correctamente.');
        return;
      }
      const nombre = formulario.nombre.value.trim();
      const direccion = formulario.direccion.value.trim();
      const tipoTarjeta = formulario['tipo-tarjeta'].value;
      const total = carrito.reduce((acc, item) => acc + item.precio * item.cantidad, 0);
      const comprobante = {
        nombre,
        direccion,
        tipoTarjeta,
        total: total.toFixed(2),
        carrito
      };
      sessionStorage.setItem('comprobante', JSON.stringify(comprobante));
      carrito = [];
      localStorage.removeItem('carrito');
      alert('춰Gracias por tu compra! Ser치s redirigido al comprobante.');
      window.location.href = 'comprobante.html';
    });

    renderCarrito();
  </script>
</body>
</html>
